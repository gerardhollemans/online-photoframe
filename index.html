<!DOCTYPE html>
<html>
<head>
  <title>Google Drive File Lister</title>
  <meta charset="utf-8">
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
    }
    #authorize-button, #folder-picker-button {
      margin: 10px 0;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
    #file-list {
      margin-top: 20px;
    }
    .file-item {
      padding: 8px;
      border-bottom: 1px solid #eee;
    }
    .folder {
      color: #4285f4;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Google Drive Folder File Lister</h1>
  
  <button id="authorize-button" style="display: none;">Sign In with Google</button>
  <button id="signout-button" style="display: none;">Sign Out</button>
  <button id="folder-picker-button" style="display: none;">Select Folder</button>
  
  <div id="content"></div>
  <div id="file-list"></div>

  <script type="text/javascript">
    // Replace with your own Client ID from Google Cloud Console
    const CLIENT_ID = '776150985676-43dmquafuliuobhkg4v73v9nj8m4n459.apps.googleusercontent.com';
    const API_KEY = 'AIzaSyDi69wPOMCgBqFy939Um1ZDHsmHdFLcGrY';
    const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest';
    const SCOPES = 'https://www.googleapis.com/auth/drive.readonly';

    let tokenClient;
    let gapiInited = false;
    let gisInited = false;
    let accessToken = null;
    let pickerInited = false;

    // Load the GIS library
    function gapiLoaded() {
      gapi.load('client:picker', initializeGapiClient);
    }

    async function initializeGapiClient() {
      await gapi.client.init({
        apiKey: API_KEY,
        discoveryDocs: [DISCOVERY_DOC],
      });
      gapiInited = true;
      maybeEnableButtons();
    }

    function gisLoaded() {
      tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: CLIENT_ID,
        scope: SCOPES,
        callback: '', // defined later
      });
      gisInited = true;
      maybeEnableButtons();
    }

    function maybeEnableButtons() {
      if (gapiInited && gisInited) {
        document.getElementById('authorize-button').style.display = 'block';
      }
    }

    function handleAuthClick() {
      tokenClient.callback = async (resp) => {
        if (resp.error !== undefined) {
          throw (resp);
        }
        accessToken = gapi.client.getToken().access_token;
        document.getElementById('signout-button').style.display = 'block';
        document.getElementById('authorize-button').style.display = 'none';
        document.getElementById('folder-picker-button').style.display = 'block';
        document.getElementById('content').innerText = 'Signed in! Click "Select Folder" to choose a folder.';
      };

      if (gapi.client.getToken() === null) {
        tokenClient.requestAccessToken({prompt: 'consent'});
      } else {
        tokenClient.requestAccessToken({prompt: ''});
      }
    }

    function handleSignoutClick() {
      const token = gapi.client.getToken();
      if (token !== null) {
        google.accounts.oauth2.revoke(token.access_token);
        gapi.client.setToken('');
        accessToken = null;
        document.getElementById('content').innerText = '';
        document.getElementById('file-list').innerHTML = '';
        document.getElementById('authorize-button').style.display = 'block';
        document.getElementById('signout-button').style.display = 'none';
        document.getElementById('folder-picker-button').style.display = 'none';
      }
    }

    // Create and render a Picker object for selecting from Drive
    function createPicker() {
      const view = new google.picker.DocsView(google.picker.ViewId.FOLDERS)
          .setSelectFolderEnabled(true);

      const picker = new google.picker.PickerBuilder()
          .enableFeature(google.picker.Feature.NAV_HIDDEN)
          .setOAuthToken(accessToken)
          .addView(view)
          .setDeveloperKey(API_KEY)
          .setCallback(pickerCallback)
          .build();
      picker.setVisible(true);
    }

    // Callback implementation for the picker
    async function pickerCallback(data) {
      if (data.action === google.picker.Action.PICKED) {
        const folderId = data.docs[0].id;
        const folderName = data.docs[0].name;
        document.getElementById('content').innerText = `Selected folder: ${folderName}`;
        await listFilesInFolder(folderId);
      }
    }

    // List files in the selected folder
    async function listFilesInFolder(folderId) {
      try {
        const response = await gapi.client.drive.files.list({
          q: `'${folderId}' in parents and trashed=false`,
          fields: 'files(id, name, mimeType, modifiedTime)',
          orderBy: 'name',
          pageSize: 100
        });

        const files = response.result.files;
        const fileListDiv = document.getElementById('file-list');
        
        if (!files || files.length === 0) {
          fileListDiv.innerHTML = '<p>No files found in this folder.</p>';
          return;
        }

        let html = '<h2>Files in folder:</h2>';
        files.forEach(file => {
          const isFolder = file.mimeType === 'application/vnd.google-apps.folder';
          const className = isFolder ? 'file-item folder' : 'file-item';
          const icon = isFolder ? 'üìÅ' : 'üìÑ';
          html += `<div class="${className}">${icon} ${file.name}</div>`;
        });
        
        fileListDiv.innerHTML = html;
      } catch (err) {
        document.getElementById('file-list').innerHTML = `<p>Error: ${err.message}</p>`;
      }
    }

    // Set up event listeners
    document.getElementById('authorize-button').addEventListener('click', handleAuthClick);
    document.getElementById('signout-button').addEventListener('click', handleSignoutClick);
    document.getElementById('folder-picker-button').addEventListener('click', createPicker);
  </script>
  
  <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
  <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
  <script async defer src="https://apis.google.com/js/api.js?onload=gapiLoaded"></script>
</body>
</html>

